/**
 * @fileoverview Firestore Security Rules for the SeatingSavvy application.
 *
 * Core Philosophy:
 * This ruleset enforces a strict user-ownership model for event data and related entities. Each user can only access the data they own, based on the user ID in the path.
 *
 * Data Structure:
 * The Firestore database is structured as follows:
 * - /events/{eventId}: Events created by any user. Contains a `userId` field for ownership.
 *
 * Key Security Decisions:
 * - Events are readable by any authenticated user but writable only by the owner.
 * - Data validation is relaxed to allow for rapid prototyping.
 * - All write operations require the user to be authenticated.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Secure access to event data.
     * @path /events/{eventId}
     */
    match /events/{eventId} {
      // Allow any authenticated user to read events
      allow read: if isSignedIn();
      
      // Allow users to create events if they are signed in and the event's userId matches their own.
      allow create: if isSignedIn() && request.resource.data.userId == request.auth.uid;
      
      // Allow users to update or delete events they own.
      allow update, delete: if isSignedIn() && resource.data.userId == request.auth.uid;
    }

    // --- Helper Functions ---
    function isSignedIn() {
      return request.auth != null;
    }
  }
}
